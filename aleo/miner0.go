package main

import (
	"bufio"
	"fmt"
	"log"
	"net"
	"time"
)

func main() {
	conn, err := net.Dial("tcp", "127.0.0.1:9096")
	//conn, err := net.Dial("tcp", "52.44.176.33:9096")
	//conn, err := net.Dial("tcp", "127.0.0.1:8888")
	if err != nil {
		log.Fatal(err)
	}

	defer conn.Close()

	reader := bufio.NewReader(conn)

	go func() {
		for {
			dat, _, err := reader.ReadLine()
			if err != nil {
				log.Fatal(err)
			}
			fmt.Println("sever:", string(dat))
		}
	}()
	//subscribe := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.subscribe\", \"params\": [\"gsa0/1.0\", \"AleoStratum/2.0.0\", null]}\n"
	subscribe := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.subscribe\", \"params\": [\"miner0\", \"AleoStratum/2.0.0\", null]}\n"

	_, err = conn.Write([]byte(subscribe))
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println("send subscribe")

	//dat, _, err := reader.ReadLine()
	//if err != nil {
	//	log.Fatal(err)
	//}
	//fmt.Println("sever:", string(dat))

	time.Sleep(1 * time.Second)

	//authorize := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.authorize\", \"params\": [\"aleo1p4jjees0xj2m6hxlgej776elcm74lwlj4m3xuqk9f6zq64zjwgpslkwd42\", \"123\"]}\n"
	authorize := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.authorize\", \"params\": [\"miner0\", \"chainsAb@\"]}\n"

	_, err = conn.Write([]byte(authorize))
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println("send authorize")
	for {
		//_, err := conn.Write([]byte("hello\n"))

		time.Sleep(5 * time.Second)

		//submit := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.submit\", \"params\": [\"123\", \"123\", \"123\"]}\n"
		//submit := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.miner0_submit\", \"params\": [125, \"123\", \"d29bd4d5060edad82a158c205c762da9848ca5310833d17e7ee50799604da82506e32dbeb8088f62cfec06ed4710b000c459264d059d7f0207de4966f22431ecd6cea46260248b97ba4e04d3c6cafb1dc1399d922b2516f99d62a2a809e4ba0040fa136f2567cbcba7e7505a0229e53dda304b08513882e3ff58094849d390ccdc6d18294fd71864d543982764a02901088e44532e4e80accd54b59869eb2114f54b4c08a70d0b49663f218ab0797ad9620978b904e4e6032688aca573218501a239e8e59864dd3d524aa77552b5f1e571e97deb2544dc519a2e47c66c074961b000783fddf7527805b131794e6b8801c585e111bc4140e382ad8812163127bbfb168279c1423b257fb494a19d27fd53ed998c67e54aa177eba1ec56416ba101b9e08ff1646df809f8ac5b5908b16dd20d9d08559ea38c1ee2ed73bdc0293163d222d712684c4a666e3c9324cdb3c6004e786a8cfe10641b166bd28f61eba43cca753bc3c0fa0d7d9f2be75af683ec936c9165ad77d12fefcd08772ce2a96500f6c274593c7993ad1c0e30179fc3a36e9dd933503adb0ff379614a878a02ab51b7e66f94514e1336aa70ff13567e2e01a8e81c054179b9b266785261871929728ac98df75de402da83430a9935c1322966f26bb24c323351f4a5bf1b8200560035537ae39f91e5d80129f1a31bb7fcda9f111aa718b6f7d446b00c5d3cca1fda9716af4669aa47b91ba339583aa3dd006bb86b07a2e38b13210152497e691620e6ff7136375626d2bdcc3a6e2d9197bc87c2f73ffac4e622181d4d7e17489a00fbcc719e32053bd10bb4486c7994c665b054d25cf8e1d6ae5c54b482f4a652c5b4d251a7bf599327e4c27c860829ad006eb43d344f0d8e6ab90c0b1a1f9daf7e6bc1d5d0ddf462654f44da038d04bdfa84fd2c1df0652d64bbe60bf81d583f0098669500f853ab38f84e3d8378ea09d959e6fd13dd070c8ef25ef7b1ff5dfc8d41b56b97b2b33e1e7dc6bea83e08790062c32cab9b77ae431b3f429cb07a743764b4ed47d5d971a16c2fca9d805abe3bc03f8ef6a39d8c47062b84f8b1d41a0084dd174d5ef040329c3236aad30b00fd860423beb0eea820c3b746b950c3c748269e022d051b4113a421b563b22aa500cc61b7683c335f9dd3162efe1ebe798b308a9709aa3dc216cd0385cac799ef092b20844b40d9144dae321d6cddf60001a9267c23a49058ee4f0f8df5963522fcd22bd55c2ad26cd037e757d494d304cfa6948b8c7a5a5323d9e9f75ae7ade500044acb26f870937db55d65509519133d035d6d3099d1cb2f1be626ea629b8c15f3b37d5c846b2c8370de95233edf750003766ff22f2a8c53885dbacdb5422d1e061b23ba45f4f3681e436047599d598b6b4810734408f49f17bb42c2d24e5f0199dbd13259c97ab1c73557e08d41b2bdd29bd4d5060edad82a158c205c762da9848ca5310833d17e7ee50799604da82506e32dbeb8088f62cfec06ed4710b000c459264d059d7f0207de4966f22431ecd6cea46260248b97ba4e04d3c6cafb1dc1399d922b2516f99d62a2a809e4ba0040fa136f2567cbcba7e7505a0229e53dda304b08513882e3ff58094849d390ccdc6d18294fd71864d543982764a02901088e44532e4e80accd54b59869eb2114f54b4c08a70d0b49663f218ab0797ad9620978b904e4e6032688aca573218501a239e8e59864dd3d524aa77552b5f1e571e97deb2544dc519a2e47c66c074961b000783fddf7527805b131794e6b8801c585e111bc4140e382ad8812163127bbfb168279c1423b257fb494a19d27fd53ed998c67e54aa177eba1ec56416ba101b9e08ff1646df809f8ac5b5908b16dd20d9d08559ea38c1ee2ed73bdc0293163d222d712684c4a666e3c9324cdb3c6004e786a8cfe10641b166bd28f61eba43cca753bc3c0fa0d7d9f2be75af683ec936c9165ad77d12fefcd08772ce2a96500f6c274593c7993ad1c0e30179fc3a36e9dd933503adb0ff379614a878a02ab51b7e66f94514e1336aa70ff13567e2e01a8e81c054179b9b266785261871929728ac98df75de402da83430a9935c1322966f26bb24c323351f4a5bf1b8200560035537ae39f91e5d80129f1a31bb7fcda9f111aa718b6f7d446b00c5d3cca1fda9716af4669aa47b91ba339583aa3dd006bb86b07a2e38b13210152497e691620e6ff7136375626d2bdcc3a6e2d9197bc87c2f73ffac4e622181d4d7e17489a00fbcc719e32053bd10bb4486c7994c665b054d25cf8e1d6ae5c54b482f4a652c5b4d251a7bf599327e4c27c860829ad006eb43d344f0d8e6ab90c0b1a1f9daf7e6bc1d5d0ddf462654f44da038d04bdfa84fd2c1df0652d64bbe60bf81d583f0098669500f853ab38f84e3d8378ea09d959e6fd13dd070c8ef25ef7b1ff5dfc8d41b56b97b2b33e1e7dc6bea83e08790062c32cab9b77ae431b3f429cb07a743764b4ed47d5d971a16c2fca9d805abe3bc03f8ef6a39d8c47062b84f8b1d41a0084dd174d5ef040329c3236aad30b00fd860423beb0eea820c3b746b950c3c748269e022d051b4113a421b563b22aa500cc61b7683c335f9dd3162efe1ebe798b308a9709aa3dc216cd0385cac799ef092b20844b40d9144dae321d6cddf60001a9267c23a49058ee4f0f8df5963522fcd22bd55c2ad26cd037e757d494d304cfa6948b8c7a5a5323d9e9f75ae7ade500044acb26f870937db55d65509519133d035d6d3099d1cb2f1be626ea629b8c15f3b37d5c846b2c8370de95233edf750003766ff22f2a8c53885dbacdb5422d1e061b23ba45f4f3681e436047599d598b6b4810734408f49f17bb42c2d24e5f0199dbd13259c97ab1c73557e08d41b2bdd29bd4d5060edad82a158c205c762da9848ca5310833d17e7ee50799604da82506e32dbeb8088f62cfec06ed4710b000c459264d059d7f0207de4966f22431ecd6cea46260248b97ba4e04d3c6cafb1dc1399d922b2516f99d62a2a809e4ba0040fa136f2567cbcba7e7505a0229e53dda304b08513882e3ff58094849d390ccdc6d18294fd71864d543982764a02901088e44532e4e80accd54b59869eb2114f54b4c08a70d0b49663f218ab0797ad9620978b904e4e6032688aca573218501a239e8e59864dd3d524aa77552b5f1e571e97deb2544dc519a2e47c66c074961b000783fddf7527805b131794e6b8801c585e111bc4140e382ad8812163127bbfb168279c1423b257fb494a19d27fd53ed998c67e54aa177eba1ec56416ba101b9e08ff1646df809f8ac5b5908b16dd20d9d08559ea38c1ee2ed73bdc0293163d222d712684c4a666e3c9324cdb3c6004e786a8cfe10641b166bd28f61eba43cca753bc3c0fa0d7d9f2be75af683ec936c9165ad77d12fefcd08772ce2a96500f6c274593c7993ad1c0e30179fc3a36e9dd933503adb0ff379614a878a02ab51b7e66f94514e1336aa70ff13567e2e01a8e81c054179b9b266785261871929728ac98df75de402da83430a9935c1322966f26bb24c323351f4a5bf1b8200560035537ae39f91e5d80129f1a31bb7fcda9f111aa718b6f7d446b00c5d3cca1fda9716af4669aa47b91ba339583aa3dd006bb86b07a2e38b13210152497e691620e6ff7136375626d2bdcc3a6e2d9197bc87c2f73ffac4e622181d4d7e17489a00fbcc719e32053bd10bb4486c7994c665b054d25cf8e1d6ae5c54b482f4a652c5b4d251a7bf599327e4c27c860829ad006eb43d344f0d8e6ab90c0b1a1f9daf7e6bc1d5d0ddf462654f44da038d04bdfa84fd2c1df0652d64bbe60bf81d583f0098669500f853ab38f84e3d8378ea09d959e6fd13dd070c8ef25ef7b1ff5dfc8d41b56b97b2b33e1e7dc6bea83e08790062c32cab9b77ae431b3f429cb07a743764b4ed47d5d971a16c2fca9d805abe3bc03f8ef6a39d8c47062b84f8b1d41a0084dd174d5ef040329c3236aad30b00fd860423beb0eea820c3b746b950c3c748269e022d051b4113a421b563b22aa500cc61b7683c335f9dd3162efe1ebe798b308a9709aa3dc216cd0385cac799ef092b20844b40d9144dae321d6cddf60001a9267c23a49058ee4f0f8df5963522fcd22bd55c2ad26cd037e757d494d304cfa6948b8c7a5a5323d9e9f75ae7ade500044acb26f870937db55d65509519133d035d6d3099d1cb2f1be626ea629b8c15f3b37d5c846b2c8370de95233edf750003766ff22\"]}\n"
		submit := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.miner0_submit\", \"params\": [126, \"123\", \"d29bd4d5060edad82a158c205c762da9848ca5310833d17e7ee50799604da82506e32dbeb8088f62cfec06ed4710b000c459264d059d7f0207de4966f22431ecd6cea46260248b97ba4e04d3c6cafb1dc1399d922b2516f99d62a2a809e4ba0040fa136f2567cbcba7e7505a0229e53dda304b08513882e3ff58094849d390ccdc6d18294fd71864d543982764a02901088e44532e4e80accd54b59869eb2114f54b4c08a70d0b49663f218ab0797ad9620978b904e4e6032688aca573218501a239e8e59864dd3d524aa77552b5f1e571e97deb2544dc519a2e47c66c074961b000783fddf7527805b131794e6b8801c585e111bc4140e382ad8812163127bbfb168279c1423b257fb494a19d27fd53ed998c67e54aa177eba1ec56416ba101b9e08ff1646df809f8ac5b5908b16dd20d9d08559ea38c1ee2ed73bdc0293163d222d712684c4a666e3c9324cdb3c6004e786a8cfe10641b166bd28f61eba43cca753bc3c0fa0d7d9f2be75af683ec936c9165ad77d12fefcd08772ce2a96500f6c274593c7993ad1c0e30179fc3a36e9dd933503adb0ff379614a878a02ab51b7e66f94514e1336aa70ff13567e2e01a8e81c054179b9b266785261871929728ac98df75de402da83430a9935c1322966f26bb24c323351f4a5bf1b8200560035537ae39f91e5d80129f1a31bb7fcda9f111aa718b6f7d446b00c5d3cca1fda9716af4669aa47b91ba339583aa3dd006bb86b07a2e38b13210152497e691620e6ff7136375626d2bdcc3a6e2d9197bc87c2f73ffac4e622181d4d7e17489a00fbcc719e32053bd10bb4486c7994c665b054d25cf8e1d6ae5c54b482f4a652c5b4d251a7bf599327e4c27c860829ad006eb43d344f0d8e6ab90c0b1a1f9daf7e6bc1d5d0ddf462654f44da038d04bdfa84fd2c1df0652d64bbe60bf81d583f0098669500f853ab38f84e3d8378ea09d959e6fd13dd070c8ef25ef7b1ff5dfc8d41b56b97b2b33e1e7dc6bea83e08790062c32cab9b77ae431b3f429cb07a743764b4ed47d5d971a16c2fca9d805abe3bc03f8ef6a39d8c47062b84f8b1d41a0084dd174d5ef040329c3236aad30b00fd860423beb0eea820c3b746b950c3c748269e022d051b4113a421b563b22aa500cc61b7683c335f9dd3162efe1ebe798b308a9709aa3dc216cd0385cac799ef092b20844b40d9144dae321d6cddf60001a9267c23a49058ee4f0f8df5963522fcd22bd55c2ad26cd037e757d494d304cfa6948b8c7a5a5323d9e9f75ae7ade500044acb26f870937db55d65509519133d035d6d3099d1cb2f1be626ea629b8c15f3b37d5c846b2c8370de95233edf750003766ff22\"]}\n"
		_, err = conn.Write([]byte(submit))
		if err != nil {
			log.Fatal(err)
		}
		time.Sleep(1 * time.Second)
		//check_result := "{\"jsonrpc\":\"2.0\",\"id\": 1, \"method\": \"mining.check_result\", \"params\": [[\"1\",\"127.0.0.1:39456\",\"a1b2c3d4\",\"0123456789abcdef\",\"commitment\", \"proof\"]]}\n"
		//
		//fmt.Println(check_result)
		//_, err = conn.Write([]byte(check_result))
		//if err != nil {
		//	log.Fatal(err)
		//}
		fmt.Println("send submit")

		time.Sleep(10 * time.Second)
	}
}
